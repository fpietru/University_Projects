#include <assert.h>
#include <inttypes.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// To jest deklaracja testowanej funkcji.
void nsqrt(uint64_t *Q, uint64_t *X, unsigned n);

#define SIZE(x) (sizeof x / sizeof x[0])

typedef __uint128_t uint128_t;

// To jest struktura przechowująca dane do testów.
typedef union {
  uint64_t  u64[2];
  uint128_t u128;
} test_data_t;

// Tu są dane do testów.
static const test_data_t test_data_table[] = {
  {{0, 0}},
  {{1, 0}},
  {{2, 0}},
  {{3, 0}},
  {{4, 0}},
  {{5, 0}},
  {{6, 0}},
  {{7, 0}},
  {{8, 0}},
  {{9, 0}},
  {{10, 0}},
  {{11, 0}},
  {{12, 0}},
  {{13, 0}},
  {{14, 0}},
  {{15, 0}},
  {{16, 0}},
  {{17, 0}},
  {{18, 0}},
  {{19, 0}},
  {{20, 0}},
  {{21, 0}},
  {{22, 0}},
  {{23, 0}},
  {{24, 0}},
  {{25, 0}},
  {{26, 0}},
  {{27, 0}},
  {{28, 0}},
  {{29, 0}},
  {{30, 0}},
  {{31, 0}},
  {{32, 0}},
  {{33, 0}},
  {{34, 0}},
  {{35, 0}},
  {{36, 0}},
  {{37, 0}},
  {{38, 0}},
  {{39, 0}},
  {{40, 0}},
  {{41, 0}},
  {{42, 0}},
  {{43, 0}},
  {{44, 0}},
  {{45, 0}},
  {{46, 0}},
  {{47, 0}},
  {{48, 0}},
  {{49, 0}},
  {{50, 0}},
  {{51, 0}},
  {{52, 0}},
  {{53, 0}},
  {{54, 0}},
  {{55, 0}},
  {{56, 0}},
  {{57, 0}},
  {{58, 0}},
  {{59, 0}},
  {{60, 0}},
  {{61, 0}},
  {{62, 0}},
  {{63, 0}},
  {{64, 0}},
  {{65, 0}},
  {{66, 0}},
  {{67, 0}},
  {{68, 0}},
  {{69, 0}},
  {{70, 0}},
  {{71, 0}},
  {{72, 0}},
  {{73, 0}},
  {{74, 0}},
  {{75, 0}},
  {{76, 0}},
  {{77, 0}},
  {{78, 0}},
  {{79, 0}},
  {{80, 0}},
  {{81, 0}},
  {{82, 0}},
  {{83, 0}},
  {{84, 0}},
  {{85, 0}},
  {{86, 0}},
  {{87, 0}},
  {{88, 0}},
  {{89, 0}},
  {{90, 0}},
  {{91, 0}},
  {{92, 0}},
  {{93, 0}},
  {{94, 0}},
  {{95, 0}},
  {{96, 0}},
  {{97, 0}},
  {{98, 0}},
  {{99, 0}},
  {{100, 0}},
  {{0, 3812}},
  {{1, 2870}},
  {{2, 7190}},
  {{3, 5363}},
  {{4, 927}},
  {{5, 3749}},
  {{6, 7611}},
  {{7, 5069}},
  {{8, 4132}},
  {{9, 7848}},
  {{10, 1891}},
  {{11, 5096}},
  {{12, 4314}},
  {{13, 1154}},
  {{14, 1640}},
  {{15, 7181}},
  {{16, 2344}},
  {{17, 1404}},
  {{18, 4795}},
  {{19, 6430}},
  {{20, 9861}},
  {{21, 7257}},
  {{22, 2994}},
  {{23, 2507}},
  {{24, 718}},
  {{25, 4449}},
  {{26, 5744}},
  {{27, 4952}},
  {{28, 1892}},
  {{29, 7635}},
  {{30, 9735}},
  {{31, 8423}},
  {{32, 9899}},
  {{33, 753}},
  {{34, 3289}},
  {{35, 1347}},
  {{36, 7682}},
  {{37, 9998}},
  {{38, 6524}},
  {{39, 3297}},
  {{40, 2301}},
  {{41, 1762}},
  {{42, 8953}},
  {{43, 3344}},
  {{44, 9879}},
  {{45, 2499}},
  {{46, 1475}},
  {{47, 336}},
  {{48, 1181}},
  {{49, 7039}},
  {{50, 6213}},
  {{51, 3791}},
  {{52, 5554}},
  {{53, 4470}},
  {{54, 8019}},
  {{55, 3740}},
  {{56, 2756}},
  {{57, 2675}},
  {{58, 9162}},
  {{59, 523}},
  {{60, 8177}},
  {{61, 2727}},
  {{62, 1540}},
  {{63, 1599}},
  {{64, 1945}},
  {{65, 1236}},
  {{66, 1448}},
  {{67, 5043}},
  {{68, 6592}},
  {{69, 8414}},
  {{70, 1873}},
  {{71, 9686}},
  {{72, 5609}},
  {{73, 9025}},
  {{74, 7625}},
  {{75, 2362}},
  {{76, 2379}},
  {{77, 329}},
  {{78, 7023}},
  {{79, 8556}},
  {{80, 4606}},
  {{81, 1819}},
  {{82, 9797}},
  {{83, 190}},
  {{84, 1177}},
  {{85, 7261}},
  {{86, 8515}},
  {{87, 8006}},
  {{88, 2583}},
  {{89, 7901}},
  {{90, 7436}},
  {{91, 4062}},
  {{92, 1843}},
  {{93, 7759}},
  {{94, 1152}},
  {{95, 5316}},
  {{96, 3226}},
  {{97, 1935}},
  {{98, 2148}},
  {{99, 3101}},
  {{100, 9296}},
  {{UINT64_MAX - 1, 0}},
  {{UINT64_MAX, 0}},
  {{0, 1}},
  {{1, 1}},
  {{UINT64_MAX - 1, UINT64_MAX}},
  {{UINT64_MAX, UINT64_MAX}}
};

int main() {
  uint64_t *Q, *X;
  Q = malloc(sizeof (uint64_t));
  X = malloc(2 * sizeof (uint64_t));
  assert(Q && X);
  for (unsigned i = 0; i < SIZE(test_data_table); ++i) {
    memcpy(X, &test_data_table[i], 2 * sizeof (uint64_t));
    
    // wypisz(X, 2);
    
    nsqrt(Q, X, 8 * sizeof (uint64_t));
    printf("%d Q = %" PRIu64 "\n", i, Q[0]);
    uint128_t Q1 = Q[0];
    uint128_t Q2 = Q1 * Q1;
    assert(Q2 <= test_data_table[i].u128 && Q2 + Q1 >= test_data_table[i].u128 - Q1);
  }
  free(Q);
  free(X);
}
